# Похожий контент
# Актуализация Виджета "Похожий контент" для InstantCMS 2.17.2

Данный репозиторий содержит обновленную версию виджета "Похожий контент" (оригинальный автор: Loadырь, версия 2.0), адаптированную для корректной работы на **InstantCMS 2.17.2** с использованием **PHP 7.4.x**.

Оригинальная страница дополнения: [Похожий контент v2.0 от Loadырь](https://instantcms.ru/addons/relevants.html)

## Цель Актуализации

Основной целью было восстановление полной работоспособности виджета на современной версии InstantCMS, включая исправление проблем с установкой, отображением и основной логикой подбора похожего контента.

## Краткое Описание Проделанных Исправлений

В процессе актуализации были решены следующие основные проблемы:

1.  **Проблемы Установки:**
    * **Отсутствие таблицы `cms_relevants`:** Таблица, необходимая для хранения настроек "релевантов", не создавалась автоматически при установке. Проблема была решена путем ручного создания таблицы и предложения улучшенного скрипта `install.php` с проверками.
    * **Отсутствие виджета в системе:** Запись о виджете не добавлялась в таблицу `cms_widgets` при установке. Решено ручным добавлением записи в БД и улучшением `install.php`.

2.  **Ошибка FULLTEXT Индекса:**
    * При работе виджета возникала ошибка, связанная с отсутствием необходимого составного `FULLTEXT` индекса для полей, используемых в поиске (например, `title` и `seo_keys` в таблицах типов контента). Проблема решена путем ручного создания соответствующего индекса в таблице целевого типа контента (например, `cms_con_news`).

3.  **Некорректная Сортировка Записей:**
    * Виджет выводил записи в порядке возрастания ID, игнорируя настройки сортировки. Файл `system/controllers/relevanter/hooks/relevant_events.php` был модифицирован для корректной обработки настроек сортировки и реализации сортировки по умолчанию (по дате публикации или ID по убыванию).

4.  **PHP Notice (при включенной отладке):**
    * Устранено (скрыто при отключении режима отладки) уведомление `Notice: Trying to access array offset on value of type bool`, связанное с кешированием.

## Состояние

После внесенных исправлений виджет корректно устанавливается (с учетом возможных ручных шагов для первоначальной настройки БД или использования обновленного `install.php`), позволяет настраивать "релеванты", отображает похожие записи на сайте и корректно их сортирует.

## Дальнейшие Действия

Рекомендуется провести всестороннее тестирование всех функций виджета на вашем конкретном сайте и с вашими настройками типов контента, чтобы убедиться в полной совместимости и отсутствии других специфических проблем.

Подробный пошаговый процесс устранения проблем можно найти в документе ([bug_fix.md](https://github.com/StasClear/pohozhii-kontent/blob/main/bug_fix.md)).

